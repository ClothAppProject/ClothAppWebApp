<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="home-side-menu">
  <template>
    <style include="shared-styles iron-flex iron-flex-alignment">

      :host {
        display: block;
      }

      paper-menu {

        padding-top: 0px;

        --paper-menu-selected-item: {
          color: var(--primary-color);
        }

        --paper-menu-focused-item-after: {
          background: var(--primary-color);
        }
      }

      paper-menu iron-icon {
        margin-right: 33px;
        opacity: 0.54;
      }

      paper-menu a {
        @apply(--layout-horizontal);
        @apply(--layout-center);

        text-decoration: none;
        color: var(--menu-link-color);
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        font-size: 14px;
        font-weight: 400;
        line-height: 24px;
        min-height: 48px;
        padding: 0 16px;
      }

      paper-dialog {
        min-width: 300px;
        padding-left: 20px;
        padding-right: 20px;
      }

    </style>

    <paper-menu class="app-menu" attr-for-selected="data-route" selected="[[route]]">

      <!-- <iron-image style="width:100%; --iron-image-width:100%; height:250px; background-color:lightgray;"
        sizing="cover" preload fade src="http://lorempixel.com/250/200"></iron-image> -->

      <!-- <a data-route="home" href="{{baseUrl}}">
        <iron-icon icon="home"></iron-icon>
        <span>Home</span>
      </a> -->

      <a data-route="most-recent-photos" href="{{baseUrl}}most-recent-photos">
        <iron-icon icon="dashboard"></iron-icon>
        <span>Most Recent Photos</span>
      </a>

      <a data-route="top-rated-photos" href="{{baseUrl}}top-rated-photos">
        <iron-icon icon="favorite"></iron-icon>
        <span>Top Rated Photos</span>
      </a>

      <a data-route="popular-shops" href="{{baseUrl}}popular-shops">
        <iron-icon icon="store"></iron-icon>
        <span>Popular Shops</span>
      </a>

      <hr>

      <a id="profileLink">
        <iron-icon icon="social:person"></iron-icon>
        <span>My Profile</span>
      </a>

      <a id="logoutLink" onclick="openLogoutDialog();">
        <iron-icon icon="exit-to-app"></iron-icon>
        <span>Logout</span>
      </a>

      <a id="loginLink" onclick="openLoginDialog();">
        <iron-icon icon="exit-to-app"></iron-icon>
        <span>Login</span>
      </a>

      <a id="signinLink" onclick="openSigninDialog();">
        <iron-icon icon="social:person-add"></iron-icon>
        <span>Sign in</span>
      </a>

      <hr>

      <a data-route="contact" href="{{baseUrl}}contact">
        <iron-icon icon="mail"></iron-icon>
        <span>Contact Us</span>
      </a>

      <a data-route="feedback" href="{{baseUrl}}feedback">
        <iron-icon icon="feedback"></iron-icon>
        <span>Feedback</span>
      </a>
    </paper-menu>

    <paper-dialog id="infoDialog" modal>

      <h2 style="margin-left:0px; padding-left:0px;">ClothApp</h2>

      <paper-dialog-scrollable>
        <p id="infoDialogMessage"></p>
      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-confirm>OK</paper-button>
      </div>

    </paper-dialog>

    <paper-dialog id="loginDialog" modal>

      <h2 style="margin-left:0px; padding-left:0px;">Login</h2>

      <paper-dialog-scrollable>
        <paper-input id="loginUsername" label="Username" name="username" focused required></paper-input>
        <paper-input id="loginPassword" label="Password" name="password" type="password" required></paper-input>
      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm onclick="submitLoginDialog();">Login</paper-button>
      </div>

    </paper-dialog>

    <paper-dialog id="logoutDialog" modal>

      <h2 style="margin-left:0px; padding-left:0px;">Logout</h2>

      <paper-dialog-scrollable>
        <p>Do you really want to logout?</p>
      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm onclick="submitLogoutDialog();">Logout</paper-button>
      </div>

    </paper-dialog>

    <paper-dialog id="signinDialog" modal>

      <h2 style="margin-left:0px; padding-left:0px;">Sign in</h2>

      <paper-dialog-scrollable>

        <h3 style="margin-bottom:0px;">Account Info</h3>
        <paper-input id="signinUsername" label="Username" name="username" focused required></paper-input>
        <paper-input id="signinPassword" label="Password" name="password" type="password" required></paper-input>
        <paper-input id="signinPasswordRepeat" label="Repeat Password" name="repeatPassword" type="password" required></paper-input>
        <paper-input id="signinEmail" label="Email" name="email" required></paper-input>

        <br>

        <h3 style="margin-bottom:0px;">About You</h3>
        <paper-input id="signinFirstName" label="First Name" name="firstName" required></paper-input>
        <paper-input id="signinLastName" label="Last Name" name="lastName" required></paper-input>
        <paper-radio-group selected="female" style="margin-top:10px; margin-bottom:0px;">
          <paper-radio-button name="female">Female</paper-radio-button>
          <paper-radio-button name="male">Male</paper-radio-button>
        </paper-radio-group>
        <paper-input id="signinBirthday" label="Birthday (dd/mm/yyyy)" name="birthday" required></paper-input>

      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm onclick="submitLoginDialog();">Sign in</paper-button>
      </div>

    </paper-dialog>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'home-side-menu',

        properties: {

          imageUrl: {
            type: String,
            value: 'http://www.placehold.it/200x200'
          },

          username: {
            type: String,
            value: 'Username'
          },

        },

        ready: function() {
          var currentUser = Parse.User.current();
          if (currentUser) {
            this.$.loginLink.style.display = "none";
            this.$.signinLink.style.display = "none";
          } else {
            this.$.profileLink.style.display = "none";
            this.$.logoutLink.style.display = "none";
          }
        },
      });
    })();

    function openLoginDialog(event) {
      document.getElementById("loginDialog").open();
    }

    function openLogoutDialog(event) {
      document.getElementById("logoutDialog").open();
    }

    function openSigninDialog(event) {
      document.getElementById("signinDialog").open();
    }

    function submitLoginDialog(event) {

      var username = document.getElementById("loginUsername").value;
      var password = document.getElementById("loginPassword").value;

      // console.log("Logging in with username " + username + " and password " + password);

      Parse.User.logIn(username, password, {
        success: function(user) {
          console.log("Login Success!");

          document.getElementById("infoDialogMessage").innerHTML = "Login completed! Welcome back " + username + "!";
          document.getElementById("infoDialog").open();

          document.getElementById("profileLink").style.display = "block";
          document.getElementById("logoutLink").style.display = "block";
          document.getElementById("loginLink").style.display = "none";
          document.getElementById("signinLink").style.display = "none";
        },
        error: function(user, error) {
          console.log("Login Failed... Error: " + error.message);

          document.getElementById("infoDialogMessage").innerHTML = "Login failed: " + error.message;
          document.getElementById("infoDialog").open();
        }
      });
    }

    function submitLogoutDialog(event) {
      Parse.User.logOut().then(() => {
        console.log("Logout completed.");

        document.getElementById("infoDialogMessage").innerHTML = "Logout completed!";
        document.getElementById("infoDialog").open();

        document.getElementById("profileLink").style.display = "none";
        document.getElementById("logoutLink").style.display = "none";
        document.getElementById("loginLink").style.display = "block";
        document.getElementById("signinLink").style.display = "block";
      });
    }
  </script>
</dom-module>
